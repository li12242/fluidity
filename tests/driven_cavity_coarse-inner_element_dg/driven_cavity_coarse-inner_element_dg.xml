<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE testproblem SYSTEM "regressiontest.dtd">

<!-- Lid-driven cavity
  -->
<testproblem>
  <name>Lid-driven cavity run with the Inner Element sub-grid scale model</name>
  <owner userid="adam"/>
  <tags>flml</tags>
  <problem_definition length="special" nprocs="1">
    <command_line>dfluidity -v1 --xml driven_cavity_coarse-inner_element_dg.flml &gt; driven_cavity_coarse-inner_element_dg.log 2&gt;&amp;1</command_line>
  </problem_definition>
  <variables>

    <variable name="full_velocity_u_max" language="python">
import vtktools
import math
from numpy import max
u=vtktools.vtu("cavity_1.vtu")
vel=u.GetVectorField('InnerElementFullVelocity')
full_velocity_u_max=max(vel[:,0])
    </variable>

    <variable name="full_velocity_v_max" language="python">
import vtktools
import math
from numpy import max
u=vtktools.vtu("cavity_1.vtu")
vel=u.GetVectorField('InnerElementFullVelocity')
full_velocity_v_max=max(vel[:,1])
    </variable>

    <variable name="full_velocity_u_max_deviation" language="python">
import vtktools
import math
from numpy import max
u=vtktools.vtu("cavity_1.vtu")
vel=u.GetVectorField('InnerElementFullVelocity')
full_velocity_u_max=max(vel[:,0])
full_velocity_u_max_deviation=abs(full_velocity_u_max - 1.0)/full_velocity_u_max
    </variable>

    <variable name="full_velocity_v_max_deviation" language="python">
import vtktools
import math
from numpy import max
u=vtktools.vtu("cavity_1.vtu")
vel=u.GetVectorField('InnerElementFullVelocity')
full_velocity_v_max=max(vel[:,1])
full_velocity_v_max_deviation=abs(full_velocity_v_max - 0.0)/((full_velocity_v_max + 1e-10))
    </variable>

  </variables>
  <pass_tests>
    <test name="Maximum full velocity component u - checking this is less than 2.0 " language="python">
    assert full_velocity_u_max &lt; 2.0
    </test>
    <test name="Maximum full velocity component u - checking this is greater than 0.9 " language="python">
    assert full_velocity_u_max &gt; 0.9
    </test>
    <test name="Accurate full velocity component u comparison with SVN 7320.  Checks the computed max u velocity component is within 1% of the value from the code of revision 7320." language="python">
    assert full_velocity_u_max_deviation &lt; 0.01
    </test>

    <test name="Maximum full velocity component v - checking this is less than 2.0 " language="python">
    assert full_velocity_v_max &lt; 2.0
    </test>
    <test name="Maximum full velocity component v - checking this is greater than -0.2 " language="python">
    assert full_velocity_v_max &gt; -0.2
    </test>
    <test name="Accurate full velocity component v comparison with SVN 7320.  Checks the computed max v velocity component is within 1% of the value from the code of revision 7320." language="python">
    assert full_velocity_v_max_deviation &lt; 0.01
    </test>
  </pass_tests>
  <warn_tests>
  </warn_tests>
</testproblem>
